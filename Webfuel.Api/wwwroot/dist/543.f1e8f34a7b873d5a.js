"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[543],{9438:(T,E,o)=>{o.d(E,{J:()=>f});var e=o(1626),t=o(4438),m=o(8304),p=o(7520),D=o(4309),c=o(5045),d=o(5312);class f extends p.V{constructor(){super(),this.httpClient=(0,t.WQX)(e.Qq),this.projectSupportApi=(0,t.WQX)(m.n),this.uploadProjectSupportFilesDialog=(0,t.WQX)(c.d),this.attachProjectSupportFilesDialog=(0,t.WQX)(D.n),this.existingFiles=[],this.uploadedFiles=[],this.submitting=!1,this.progress=null}addUploadedFiles(){this.uploadProjectSupportFilesDialog.open({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(i=>{i.uploadedFiles.forEach(s=>{var a=this.uploadedFiles.findIndex(F=>F.name==s.name);a>=0?this.uploadedFiles[a]=s:this.uploadedFiles.push(s)})})}addAttachedFiles(){this.projectSupportApi.selectFile({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(i=>{this.attachProjectSupportFilesDialog.open({databaseFiles:i,existingFiles:this.existingFiles}).subscribe(s=>{this.existingFiles=s.existingFiles})})}removeUploadedFile(i,s){s.preventDefault(),s.stopPropagation();var a=this.uploadedFiles.indexOf(i);-1!==a&&this.uploadedFiles.splice(a,1)}removeExistingFile(i,s){s.preventDefault(),s.stopPropagation();var a=this.existingFiles.indexOf(i);-1!==a&&this.existingFiles.splice(a,1)}submitFiles(){var i=this.toFormData();null!=i?this.httpClient.post(d.c.apiHost+"api/project-support/upload-file",i,{reportProgress:!0,observe:"events"}).subscribe({next:s=>{if(s.type===e.hv.UploadProgress&&s.total&&(this.progress=Math.round(100*s.loaded/s.total)),s.type===e.hv.Response){console.log(s);var a=s.body;this.uploadedFiles=[],this.existingFiles=this.existingFiles.concat(a),this.submitForm()}},error:s=>{this.fileSubmissionError(s)}}):this.submitForm()}toFormData(){if(!this.uploadedFiles||!this.uploadedFiles.length)return null;const i=new FormData;for(var s=0;s<this.uploadedFiles.length;s++)i.append("file_"+s,this.uploadedFiles[s]);return i.append("data",JSON.stringify({projectSupportGroupId:this.data.projectSupportGroupId})),i}fileSubmissionError(i){this.submitting=!1,this.progress=null,console.log("File Submission Error: ",i),alert("There was an error uploading your files.\n\nPlease ensure all files are saved on your computer, and not open in another application.")}}},6628:(T,E,o)=>{o.d(E,{w:()=>b});var e=o(1626),t=o(4438),m=o(9079),p=o(4341),D=o(152),c=o(9636),d=o(5312),f=o(4722),l=o(4247),i=o(7941),s=o(3916),a=o(4312),F=o(3548),C=o(177),M=o(2817),P=o(9011),B=o(1062),O=o(1435),G=o(1321);const j=r=>({id:r});function x(r,g){if(1&r&&(t.j41(0,"form",18),t.nrm(1,"file-input",19),t.k0s()),2&r){const n=t.XpG();t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("showFiles",!1)("progress",n.progress)}}function A(r,g){if(1&r&&(t.j41(0,"span",23),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&r){let n;const _=g.$implicit,u=t.XpG(3);t.R7$(),t.JRh(null==(n=t.bMT(2,1,u.staticDataCache.fileTag.get(t.eq3(3,j,_))))?null:n.name)}}function R(r,g){if(1&r&&(t.j41(0,"div",22),t.Z7z(1,A,3,5,"span",23,t.fX1),t.k0s()),2&r){const n=t.XpG().$implicit;t.R7$(),t.Dyx(n.fileTagIds)}}function U(r,g){if(1&r&&(t.j41(0,"a",20),t.nrm(1,"i",21),t.EFF(2),t.k0s(),t.DNE(3,R,3,0,"div",22)),2&r){const n=g.$implicit,_=t.XpG();t.FS9("href",_.sasRedirect(n),t.B4B),t.R7$(2),t.SpI("\xa0",n.fileName,""),t.R7$(),t.vxM(3,n.fileTagIds&&n.fileTagIds.length>0?3:-1)}}function y(r,g){if(1&r&&t.EFF(0),2&r){const n=g.$implicit,_=t.XpG();t.SpI(" ",_.formatSize(n)," ")}}function S(r,g){1&r&&(t.j41(0,"div")(1,"i"),t.EFF(2,"Support Request Form"),t.k0s()())}function k(r,g){if(1&r&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&r){const n=t.XpG().$implicit,_=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,_.userService.formatUser(n.uploadedByUserId))," ")}}function W(r,g){if(1&r&&t.DNE(0,S,3,0,"div",24)(1,k,3,3,"div",24),2&r){const n=g.$implicit;t.Y8G("ngIf",null===n.uploadedByUserId),t.R7$(),t.Y8G("ngIf",null!==n.uploadedByUserId)}}function K(r,g){if(1&r){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,h=t.XpG();return t.Njj(h.editFile(u))}),t.EFF(1,"edit tags"),t.k0s()}}function L(r,g){if(1&r){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,h=t.XpG();return t.Njj(h.searchSupport(u))}),t.EFF(1,"search support"),t.k0s()}}function X(r,g){if(1&r){const n=t.RV6();t.j41(0,"a",28),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,h=t.XpG();return t.Njj(h.deleteFile(u))}),t.EFF(1,"delete"),t.k0s()}}function N(r,g){if(1&r&&(t.DNE(0,K,2,0,"a",25),t.EFF(1," \xa0|\xa0 "),t.DNE(2,L,2,0,"a",25),t.EFF(3," \xa0|\xa0 "),t.DNE(4,X,2,0,"a",26)),2&r){const n=t.XpG();t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked)}}let b=(()=>{class r{constructor(n,_,u,h,I,v,$){this.router=n,this.httpClient=_,this.confirmDeleteDialog=u,this.fileEditorDialog=h,this.fileStorageEntryApi=I,this.userService=v,this.staticDataCache=$,this.destroyRef=(0,t.WQX)(t.abz),this.projectId=null,this.locked=!1,this.filterForm=new p.gE({search:new p.MJ("",{nonNullable:!0}),fileTagId:new p.MJ(null)}),this.progress=null,this.form=new p.gE({fileStorageGroupId:new p.MJ("",{nonNullable:!0}),files:new p.MJ([])})}ngOnInit(){this.form.valueChanges.pipe((0,D.B)(200),(0,m.pQ)(this.destroyRef)).subscribe(()=>{this.uploadFiles()})}resetFilterForm(){this.filterForm.patchValue({search:"",fileTagId:null})}filter(n){n.fileStorageGroupId=this.fileStorageGroupId}formatSize(n){return c.A.formatBytes(n.sizeBytes)}sasRedirect(n){return d.c.apiHost+"api/file-storage-entry/sas-redirect/"+n.id}uploadFiles(){if(!this.locked&&this.form.value.files&&0!=this.form.value.files.length){this.form.patchValue({fileStorageGroupId:this.fileStorageGroupId},{emitEvent:!1});var n=this.toFormData(this.form.value);this.httpClient.post(d.c.apiHost+"api/file-storage-entry/upload",n,{reportProgress:!0,observe:"events"}).subscribe({next:_=>{_.type===e.hv.UploadProgress&&_.total&&(this.progress=Math.round(100*_.loaded/_.total))},error:_=>{console.log("Error: ",_)},complete:()=>{this.progress=null,this.fileStorageEntryApi.changed.next(null),this.form.patchValue({files:[]},{emitEvent:!1})}})}}toFormData(n){const _=new FormData;var u={};for(const v of Object.keys(n))if("files"==v){var h=n[v];if(h&&h.length)for(var I=0;I<h.length;I++)_.append("file_"+I,h[I])}else u[v]=n[v];return _.append("data",JSON.stringify(u)),_}deleteFile(n){this.locked||this.confirmDeleteDialog.open({title:n.fileName}).subscribe(_=>{this.fileStorageEntryApi.delete({id:n.id},{successGrowl:"File Deleted"}).subscribe(()=>{})})}editFile(n){this.locked||this.fileEditorDialog.open({file:n}).subscribe(()=>{})}searchSupport(n){c.A.setLocalStorage("SupportFileSearch",n.fileName),null!==this.projectId&&this.router.navigateByUrl(`/project/project-support/${this.projectId}`)}static{this.\u0275fac=function(_){return new(_||r)(t.rXU(f.Ix),t.rXU(e.Qq),t.rXU(l.K),t.rXU(i.U),t.rXU(s.c),t.rXU(a.D),t.rXU(F.t))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["file-browser"]],inputs:{fileStorageGroupId:"fileStorageGroupId",projectId:"projectId",locked:"locked"},decls:27,vars:8,consts:[["itemTemplate",""],[1,"file-list"],[3,"formGroup",4,"ngIf"],[1,"filter-form"],[1,"form",3,"formGroup"],[1,"flex"],[1,"field","is-9"],["type","text","formControlName","search","placeholder","Search",1,"input"],[1,"field","is-3"],["placeholder","Tag","formControlName","fileTagId",3,"dataSource","enableClear","enableSearch"],[1,"is-12","is-right"],[1,"button","is-small",3,"click"],[3,"filter","dataSource","filterForm","take"],["name","filename"],["name","size"],["name","uploadedAt"],["name","uploadedBy"],["justify","right"],[3,"formGroup"],["formControlName","files",3,"showFiles","progress"],["target","blank",1,"link","is-primary",3,"href"],[1,"fas","fa-link"],[1,"tags",2,"margin-top","0.5rem","max-width","500px"],[1,"tag","is-small"],[4,"ngIf"],["class","link is-primary",3,"click",4,"ngIf"],["class","link is-danger",3,"click",4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(_,u){if(1&_){const h=t.RV6();t.j41(0,"div",1),t.DNE(1,x,2,3,"form",2),t.j41(2,"div",3)(3,"form",4)(4,"div",5)(5,"div",6),t.nrm(6,"input",7),t.k0s(),t.j41(7,"div",8),t.nrm(8,"dropdown-select",9),t.k0s()(),t.j41(9,"div",5)(10,"div",10)(11,"button",11),t.bIt("click",function(){return t.eBV(h),t.Njj(u.resetFilterForm())}),t.EFF(12,"show all"),t.k0s()()()()(),t.j41(13,"grid",12),t.bIt("filter",function(v){return t.eBV(h),t.Njj(u.filter(v))}),t.j41(14,"grid-column",13),t.DNE(15,U,4,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(17,"grid-column",14),t.DNE(18,y,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(20,"grid-datetime-column",15),t.j41(21,"grid-column",16),t.DNE(22,W,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.j41(24,"grid-column",17),t.DNE(25,N,5,3,"ng-template",null,0,t.C5r),t.k0s()()()}2&_&&(t.R7$(),t.Y8G("ngIf",!u.locked),t.R7$(2),t.Y8G("formGroup",u.filterForm),t.R7$(5),t.Y8G("dataSource",u.staticDataCache.fileTag)("enableClear",!0)("enableSearch",!0),t.R7$(5),t.Y8G("dataSource",u.fileStorageEntryApi)("filterForm",u.filterForm)("take",100))},dependencies:[C.bT,p.qT,p.me,p.BC,p.cb,p.j4,p.JD,M.p,P.k,B._,O.C,G.F,C.Jj],encapsulation:2})}}return r})()},3376:(T,E,o)=>{o.d(E,{y:()=>l});var e=o(4438),t=o(1435),m=o(177);function p(i,s){if(1&i){const a=e.RV6();e.j41(0,"a",3),e.bIt("click",function(){e.eBV(a);const C=e.XpG(2);return e.Njj(C.onAdd())}),e.EFF(1,"add"),e.k0s()}}function D(i,s){if(1&i&&e.DNE(0,p,2,0,"a",2),2&i){const a=e.XpG();e.Y8G("ngIf",a.canAdd)}}function c(i,s){if(1&i){const a=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(a);const C=e.XpG().$implicit,M=e.XpG();return e.Njj(M.onEdit(C))}),e.EFF(1,"view/edit"),e.k0s()}}function d(i,s){if(1&i){const a=e.RV6();e.j41(0,"span"),e.EFF(1," \xa0 "),e.j41(2,"a",7),e.bIt("click",function(){e.eBV(a);const C=e.XpG().$implicit,M=e.XpG();return e.Njj(M.onDelete(C))}),e.EFF(3,"delete"),e.k0s()()}}function f(i,s){if(1&i&&e.DNE(0,c,2,0,"a",4)(1,d,4,0,"span",5),2&i){const a=e.XpG();e.Y8G("ngIf",a.canEdit),e.R7$(),e.Y8G("ngIf",a.canDelete)}}let l=(()=>{class i extends t.C{constructor(){super(),this.canAdd=!0,this.add=new e.bkB,this.canEdit=!0,this.edit=new e.bkB,this.canDelete=!0,this.delete=new e.bkB,this.justify="right"}onAdd(){this.add.emit()}onEdit(a){this.edit.emit(a)}onDelete(a){this.delete.emit(a)}static{this.\u0275fac=function(F){return new(F||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["grid-action-column"]],inputs:{canAdd:"canAdd",canEdit:"canEdit",canDelete:"canDelete"},outputs:{add:"add",edit:"edit",delete:"delete"},features:[e.Jv_([{provide:t.C,useExisting:i}]),e.Vt3],decls:4,vars:0,consts:[["headTemplate",""],["itemTemplate",""],["class","link is-success",3,"click",4,"ngIf"],[1,"link","is-success",3,"click"],["class","link is-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(F,C){1&F&&e.DNE(0,D,1,1,"ng-template",null,0,e.C5r)(2,f,2,2,"ng-template",null,1,e.C5r)},dependencies:[m.bT],encapsulation:2})}}return i})()},1050:(T,E,o)=>{o.d(E,{u:()=>D});var e=o(1435),t=o(4438),m=o(177);function p(c,d){if(1&c&&(t.EFF(0),t.nI1(1,"date")),2&c){const f=d.$implicit,l=t.XpG();t.SpI(" ",t.i5U(1,1,f[l.name],"dd MMM yyyy"),"\n")}}let D=(()=>{class c extends e.C{static{this.\u0275fac=(()=>{let f;return function(i){return(f||(f=t.xGo(c)))(i||c)}})()}static{this.\u0275cmp=t.VBU({type:c,selectors:[["grid-date-column"]],features:[t.Jv_([{provide:e.C,useExisting:c}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(l,i){1&l&&t.DNE(0,p,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return c})()},1321:(T,E,o)=>{o.d(E,{F:()=>D});var e=o(1435),t=o(4438),m=o(177);function p(c,d){if(1&c&&(t.EFF(0),t.nI1(1,"date")),2&c){const f=d.$implicit,l=t.XpG();t.SpI(" ",t.i5U(1,1,f[l.name],"dd MMM yyyy HH:mm"),"\n")}}let D=(()=>{class c extends e.C{static{this.\u0275fac=(()=>{let f;return function(i){return(f||(f=t.xGo(c)))(i||c)}})()}static{this.\u0275cmp=t.VBU({type:c,selectors:[["grid-datetime-column"]],features:[t.Jv_([{provide:e.C,useExisting:c}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(l,i){1&l&&t.DNE(0,p,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return c})()},9779:(T,E,o)=>{o.d(E,{h:()=>c});var e=o(1435),t=o(4412),m=o(4438),p=o(177);function D(d,f){if(1&d&&(m.EFF(0),m.nI1(1,"async")),2&d){const l=f.$implicit,i=m.XpG();m.SpI(" ",i.format(m.bMT(1,1,i.lookup(l[i.name]))),"\n")}}let c=(()=>{class d extends e.C{constructor(){super(...arguments),this._cache={}}lookup(l){if(null==this._cache[l]){if(this._cache[l]=new t.t(null),!this.dataSource)return new t.t(null);this.dataSource.query({skip:0,take:1,filters:[{field:"id",op:"eq",value:l}]}).subscribe(i=>{1==i.items.length&&this._cache[l].next(i.items[0])})}return this._cache[l]}format(l){return l?l.name:""}static{this.\u0275fac=(()=>{let l;return function(s){return(l||(l=m.xGo(d)))(s||d)}})()}static{this.\u0275cmp=m.VBU({type:d,selectors:[["grid-reference-column"]],inputs:{dataSource:"dataSource"},features:[m.Jv_([{provide:e.C,useExisting:d}]),m.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(i,s){1&i&&m.DNE(0,D,2,3,"ng-template",null,0,m.C5r)},dependencies:[p.Jj],encapsulation:2})}}return d})()}}]);