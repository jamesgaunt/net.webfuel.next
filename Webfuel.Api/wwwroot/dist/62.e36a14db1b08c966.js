"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[62],{1435:(y,k,a)=>{a.d(k,{C:()=>G});var t=a(9636),r=a(4438);const d=["headTemplate"],c=["itemTemplate"];function g(p,b){if(1&p&&r.EFF(0),2&p){const l=b.$implicit,_=r.XpG();r.SpI(" ",l[_.name],"\n")}}let G=(()=>{class p{constructor(){this.name="",this.justify="left",this._sortable=!0,this.grid=null}get label(){return null==this._label&&(this._label=t.A.splitCamelCase(this.name),this._label.endsWith(" Id")&&(this._label=this._label.substring(0,this._label.length-3))),this._label}set label(l){this._label=l}get sortable(){return!(!this.grid||this.grid.sortable)&&this._sortable}set sortable(l){this._sortable=l}get headTemplateRef(){return this.customHeadTemplate?this.customHeadTemplate:this.textHeadTemplate}get itemTemplateRef(){return this.customItemTemplate?this.customItemTemplate:this.textItemTemplate}get direction(){return this.grid?this.grid.columnDirection(this):0}static{this.\u0275fac=function(_){return new(_||p)}}static{this.\u0275cmp=r.VBU({type:p,selectors:[["grid-column"]],contentQueries:function(_,f,m){if(1&_&&(r.wni(m,d,5),r.wni(m,c,7)),2&_){let h;r.mGM(h=r.lsd())&&(f.customHeadTemplate=h.first),r.mGM(h=r.lsd())&&(f.customItemTemplate=h.first)}},viewQuery:function(_,f){if(1&_&&(r.GBs(d,5),r.GBs(c,7)),2&_){let m;r.mGM(m=r.lsd())&&(f.textHeadTemplate=m.first),r.mGM(m=r.lsd())&&(f.textItemTemplate=m.first)}},inputs:{name:"name",label:"label",justify:"justify",sortable:"sortable"},decls:2,vars:0,consts:[["itemTemplate",""]],template:function(_,f){1&_&&r.DNE(0,g,1,1,"ng-template",null,0,r.C5r)},encapsulation:2})}}return p})()},1062:(y,k,a)=>{a.d(k,{_:()=>P});var t=a(4438),r=a(1435),d=a(9636),c=a(4341),g=a(152),G=a(9079),p=a(1965),b=a(177),l=a(1875);const _=i=>({$implicit:i});function f(i,o){if(1&i&&(t.j41(0,"form",7),t.nrm(1,"input",8),t.k0s()),2&i){const e=t.XpG();t.Y8G("formGroup",e.searchForm)}}function m(i,o){1&i&&t.nrm(0,"th",9)}function h(i,o){1&i&&t.eu8(0)}function v(i,o){1&i&&(t.j41(0,"span"),t.nrm(1,"i",13),t.k0s())}function F(i,o){1&i&&(t.j41(0,"span"),t.nrm(1,"i",14),t.k0s())}function R(i,o){if(1&i){const e=t.RV6();t.j41(0,"a",12),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2).$implicit,u=t.XpG();return t.Njj(u.columnSort(n))}),t.EFF(1),t.DNE(2,v,2,0,"span",5)(3,F,2,0,"span",5),t.k0s()}if(2&i){const e=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("ngIf",e.direction>0),t.R7$(),t.Y8G("ngIf",e.direction<0)}}function T(i,o){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG(2).$implicit;t.R7$(),t.JRh(e.label)}}function E(i,o){if(1&i&&(t.j41(0,"div"),t.DNE(1,R,4,3,"a",11)(2,T,2,1,"span",5),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",e.sortable),t.R7$(),t.Y8G("ngIf",!e.sortable)}}function I(i,o){if(1&i&&(t.j41(0,"th"),t.DNE(1,h,1,0,"ng-container",10)(2,E,3,2,"div",5),t.k0s()),2&i){const e=o.$implicit;t.xc7("text-align",e.justify),t.R7$(),t.Y8G("ngTemplateOutlet",e.headTemplateRef),t.R7$(),t.Y8G("ngIf",!e.headTemplateRef)}}function x(i,o){1&i&&t.nrm(0,"i",22)}function D(i,o){1&i&&t.nrm(0,"i",23)}function j(i,o){if(1&i&&(t.j41(0,"td",19),t.DNE(1,x,1,0,"i",20)(2,D,1,0,"i",21),t.k0s()),2&i){const e=t.XpG(3);t.R7$(),t.Y8G("ngIf",!e.sorting),t.R7$(),t.Y8G("ngIf",e.sorting)}}function $(i,o){1&i&&t.eu8(0)}function Y(i,o){if(1&i&&(t.j41(0,"td"),t.DNE(1,$,1,0,"ng-container",24),t.k0s()),2&i){const e=o.$implicit,s=t.XpG().$implicit;t.xc7("text-align",e.justify),t.R7$(),t.Y8G("ngTemplateOutlet",e.itemTemplateRef)("ngTemplateOutletContext",t.eq3(4,_,s))}}function O(i,o){if(1&i&&(t.j41(0,"tr",17),t.DNE(1,j,3,2,"td",18)(2,Y,2,6,"td",3),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.Y8G("ngIf",e.sortable),t.R7$(),t.Y8G("ngForOf",e.columns)}}function B(i,o){if(1&i){const e=t.RV6();t.j41(0,"tbody",15),t.bIt("cdkDropListDropped",function(n){t.eBV(e);const u=t.XpG();return t.Njj(u.drop(n))}),t.DNE(1,O,3,2,"tr",16),t.k0s()}if(2&i){const e=t.XpG();t.Y8G("cdkDropListDisabled",!e.sortable),t.R7$(),t.Y8G("ngForOf",e.items)}}function M(i,o){if(1&i&&(t.j41(0,"tbody")(1,"tr")(2,"td")(3,"i"),t.EFF(4,"No items to display"),t.k0s()()()()),2&i){const e=t.XpG();t.R7$(2),t.BMQ("colspan",e.columnCount)}}function S(i,o){if(1&i&&(t.j41(0,"tbody")(1,"tr")(2,"td"),t.EFF(3," Loading... "),t.k0s()()()),2&i){const e=t.XpG();t.R7$(2),t.BMQ("colspan",e.columnCount)}}function q(i,o){1&i&&t.nrm(0,"div")}function L(i,o){if(1&i){const e=t.RV6();t.j41(0,"button",34),t.bIt("click",function(){const n=t.eBV(e).$implicit,u=t.XpG(3);return t.Njj(u.repage(n))}),t.EFF(1),t.k0s()}if(2&i){const e=o.$implicit,s=t.XpG(3);t.Y8G("disabled",s.pageIndex==e),t.R7$(),t.JRh(e+1)}}function X(i,o){if(1&i&&(t.j41(0,"div"),t.DNE(1,L,2,2,"button",33),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.range(e.pageCount))}}function N(i,o){if(1&i){const e=t.RV6();t.j41(0,"div",35)(1,"button",34),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.repage(0))}),t.EFF(2,"First"),t.k0s(),t.j41(3,"button",34),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.repage(n.pageIndex-1))}),t.EFF(4,"\xab"),t.k0s(),t.j41(5,"button",36),t.EFF(6),t.k0s(),t.j41(7,"button",34),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.repage(n.pageIndex+1))}),t.EFF(8,"\xbb"),t.k0s(),t.j41(9,"button",34),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.repage(n.pageCount-1))}),t.EFF(10,"Last"),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(),t.Y8G("disabled",e.pageIndex<=0),t.R7$(2),t.Y8G("disabled",e.pageIndex<=0),t.R7$(3),t.JRh(e.pageIndex+1),t.R7$(),t.Y8G("disabled",e.pageIndex>=e.pageCount-1),t.R7$(2),t.Y8G("disabled",e.pageIndex>=e.pageCount-1)}}function A(i,o){if(1&i){const e=t.RV6();t.j41(0,"div",25)(1,"div",26)(2,"div",27),t.DNE(3,q,1,0,"div",5)(4,X,2,1,"div",5)(5,N,11,5,"div",28),t.k0s(),t.j41(6,"div",29)(7,"select",30),t.bIt("change",function(n){t.eBV(e);const u=t.XpG();return t.Njj(u.retake(n))}),t.nrm(8,"option",31),t.j41(9,"option",32),t.EFF(10,"5"),t.k0s(),t.j41(11,"option",32),t.EFF(12,"10"),t.k0s(),t.j41(13,"option",32),t.EFF(14,"15"),t.k0s(),t.j41(15,"option",32),t.EFF(16,"20"),t.k0s(),t.j41(17,"option",32),t.EFF(18,"25"),t.k0s(),t.j41(19,"option",32),t.EFF(20,"30"),t.k0s(),t.j41(21,"option",32),t.EFF(22,"40"),t.k0s(),t.j41(23,"option",32),t.EFF(24,"50"),t.k0s(),t.j41(25,"option",32),t.EFF(26,"100"),t.k0s()(),t.EFF(27),t.k0s()()()}if(2&i){const e=t.XpG();t.R7$(3),t.Y8G("ngIf",e.pageCount<=1),t.R7$(),t.Y8G("ngIf",e.pageCount>1&&e.pageCount<=12),t.R7$(),t.Y8G("ngIf",e.pageCount>12),t.R7$(4),t.Y8G("selected",5==e.query.take),t.R7$(2),t.Y8G("selected",10==e.query.take),t.R7$(2),t.Y8G("selected",15==e.query.take),t.R7$(2),t.Y8G("selected",20==e.query.take),t.R7$(2),t.Y8G("selected",25==e.query.take),t.R7$(2),t.Y8G("selected",30==e.query.take),t.R7$(2),t.Y8G("selected",40==e.query.take),t.R7$(2),t.Y8G("selected",50==e.query.take),t.R7$(2),t.Y8G("selected",100==e.query.take),t.R7$(2),t.SpI(" / ",e.totalCount," ")}}let P=(()=>{class i{constructor(e,s){this.cd=e,this.queryService=s,this.destroyRef=(0,t.WQX)(t.abz),this.filterForm=null,this.filter=new t.bkB,this.search=!1,this.stateKey="",this.take=null,this.searchForm=new c.gE({search:new c.MJ("",{nonNullable:!0})}),this.query={skip:0,take:10,sort:[],filters:[],projection:[],search:""},this.items=[],this.totalCount=-1,this.columns=[],this.pageIndex=0,this.pageCount=0,this.sorting=!1}fetch(){if(this.dataSource){this.sortable&&(this.query.skip=0,this.query.take=100);var e=this.buildQuery();this.dataSource.query(e).subscribe(s=>{if(s.totalCount>0&&0===s.items.length&&this.query.skip>0)return this.query.skip=0,void this.fetch();this.saveState(),this.sorting=!1,this.items=s.items,this.totalCount=s.totalCount,this.calculatePage(),this.cd.detectChanges()})}}buildQuery(){var e=this.query;return this.filterForm&&(e=d.A.merge(e,this.filterForm.getRawValue())),this.search&&(e=d.A.merge(e,this.searchForm.getRawValue())),this.filter&&this.filter.emit(e),e}get columnCount(){return this.columns.length+(this.sortable?1:0)}saveState(){if(this.stateKey){var e={query:this.query};this.filterForm&&(e.filterForm=this.filterForm.getRawValue()),console.log("Saving Grid State: "+this.stateKey,e),d.A.setLocalStorage("GridState:"+this.stateKey,e,86400)}}loadState(){if(null!=this.take&&(this.query.take=this.take),this.stateKey){var e=d.A.getLocalStorage("GridState:"+this.stateKey);!e||!e.query||(console.log("Loaded Grid State: "+this.stateKey,e),this.query=e.query,(e.filterForm||this.filterForm)&&this.filterForm?.patchValue(e.filterForm,{emitEvent:!1}))}}range(e){return d.A.range(e)}calculatePage(){this.query.take<=0?(this.pageIndex=0,this.pageCount=1):(this.pageIndex=Math.floor(this.query.skip/this.query.take),this.pageCount=Math.ceil(this.totalCount/this.query.take))}repage(e){this.query.skip=this.query.take*e,this.fetch()}retake(e){this.query.skip=0,this.query.take=parseInt(e.target.value,10),this.fetch()}get sortable(){return this.dataSource&&this.dataSource.sort}drop(e){if(!this.sortable||this.sorting)return;this.sorting=!0;var s=e.currentIndex;const u=this.items.splice(e.previousIndex,1);this.items.splice(s,0,u[0]),this.dataSource.sort({ids:d.A.map(this.items,C=>C.id)}).subscribe()}columnSort(e){this.queryService.sortToggle(this.query,e.name),this.fetch()}columnDirection(e){return this.queryService.sortDirection(this.query,e.name)}ngAfterViewInit(){this.loadState(),this.columns=this.columnQuery.toArray(),d.A.forEach(this.columns,e=>{e.grid=this}),this.dataSource&&this.dataSource.changed&&this.dataSource.changed.pipe((0,g.B)(250),(0,G.pQ)(this.destroyRef)).subscribe(()=>this.fetch()),this.filterForm&&this.filterForm.valueChanges.pipe((0,g.B)(200),(0,G.pQ)(this.destroyRef)).subscribe(()=>this.fetch()),this.search&&this.searchForm.valueChanges.pipe((0,g.B)(250),(0,G.pQ)(this.destroyRef)).subscribe(()=>this.fetch()),this.fetch(),this.cd.detectChanges()}static{this.\u0275fac=function(s){return new(s||i)(t.rXU(t.gRc),t.rXU(p.c))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["grid"]],contentQueries:function(s,n,u){if(1&s&&t.wni(u,r.C,4),2&s){let C;t.mGM(C=t.lsd())&&(n.columnQuery=C)}},inputs:{dataSource:"dataSource",filterForm:"filterForm",search:"search",stateKey:"stateKey",take:"take"},outputs:{filter:"filter"},decls:11,vars:7,consts:[["class","form",3,"formGroup",4,"ngIf"],[1,"table"],["class","is-narrow",4,"ngIf"],[3,"text-align",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListLockAxis","y",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf"],[4,"ngIf"],["class","table-pager",4,"ngIf"],[1,"form",3,"formGroup"],["type","text","placeholder","Search...","formControlName","search",1,"input"],[1,"is-narrow"],[4,"ngTemplateOutlet"],["class","data-sorter","href","javascript:;",3,"click",4,"ngIf"],["href","javascript:;",1,"data-sorter",3,"click"],[1,"fas","fa-sort-amount-down-alt"],[1,"fas","fa-sort-amount-down"],["cdkDropList","","cdkDropListLockAxis","y",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",4,"ngFor","ngForOf"],["cdkDrag",""],["class","drag-handle is-narrow","cdkDragHandle","",4,"ngIf"],["cdkDragHandle","",1,"drag-handle","is-narrow"],["class","fas fa-fw fa-bars",4,"ngIf"],["class","fas fa-fw fa-spin fa-sync",4,"ngIf"],[1,"fas","fa-fw","fa-bars"],[1,"fas","fa-fw","fa-spin","fa-sync"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"table-pager"],[1,"columns","is-mobile"],[1,"column"],["class","buttons",4,"ngIf"],[1,"column","is-right"],[2,"text-align","right","background-color","transparent","border","0",3,"change"],[2,"display","none"],[3,"selected"],["class","button is-primary is-small",3,"disabled","click",4,"ngFor","ngForOf"],[1,"button","is-primary","is-small",3,"click","disabled"],[1,"buttons"],[1,"button","is-primary","is-small",3,"disabled"]],template:function(s,n){1&s&&(t.DNE(0,f,2,1,"form",0),t.j41(1,"div",1)(2,"table")(3,"thead")(4,"tr"),t.DNE(5,m,1,0,"th",2)(6,I,3,4,"th",3),t.k0s()(),t.DNE(7,B,2,2,"tbody",4)(8,M,5,1,"tbody",5)(9,S,4,1,"tbody",5),t.k0s()(),t.DNE(10,A,28,13,"div",6)),2&s&&(t.Y8G("ngIf",n.search),t.R7$(5),t.Y8G("ngIf",n.sortable),t.R7$(),t.Y8G("ngForOf",n.columns),t.R7$(),t.Y8G("ngIf",n.totalCount>0),t.R7$(),t.Y8G("ngIf",0==n.totalCount),t.R7$(),t.Y8G("ngIf",n.totalCount<0),t.R7$(),t.Y8G("ngIf",n.totalCount>n.items.length))},dependencies:[b.Sq,b.bT,b.T3,c.qT,c.xH,c.y7,c.me,c.BC,c.cb,c.j4,c.JD,l.O7,l.T1,l.Fb],encapsulation:2,changeDetection:0})}}return i})()}}]);