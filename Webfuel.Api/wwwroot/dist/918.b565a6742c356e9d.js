"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[918],{6628:(B,C,n)=>{n.d(C,{w:()=>x});var e=n(1626),t=n(4438),_=n(9079),u=n(4341),D=n(152),s=n(9636),c=n(5312),p=n(4247),r=n(3916),i=n(4312),d=n(177),m=n(9011),h=n(1062),v=n(1435),M=n(1321);function O(l,f){if(1&l&&(t.j41(0,"form",9),t.nrm(1,"file-input",10),t.k0s()),2&l){const o=t.XpG();t.Y8G("formGroup",o.form),t.R7$(),t.Y8G("showFiles",!1)("progress",o.progress)}}function F(l,f){if(1&l&&(t.j41(0,"a",11),t.nrm(1,"i",12),t.EFF(2),t.k0s()),2&l){const o=f.$implicit,a=t.XpG();t.FS9("href",a.sasRedirect(o),t.B4B),t.R7$(2),t.SpI("\xa0",o.fileName,"")}}function P(l,f){if(1&l&&t.EFF(0),2&l){const o=f.$implicit,a=t.XpG();t.SpI(" ",a.formatSize(o)," ")}}function G(l,f){1&l&&(t.j41(0,"div")(1,"i"),t.EFF(2,"Support Request Form"),t.k0s()())}function A(l,f){if(1&l&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&l){const o=t.XpG().$implicit,a=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,a.userService.formatUser(o.uploadedByUserId))," ")}}function y(l,f){if(1&l&&t.DNE(0,G,3,0,"div",13)(1,A,3,3,"div",13),2&l){const o=f.$implicit;t.Y8G("ngIf",null===o.uploadedByUserId),t.R7$(),t.Y8G("ngIf",null!==o.uploadedByUserId)}}function R(l,f){if(1&l){const o=t.RV6();t.j41(0,"a",15),t.bIt("click",function(){t.eBV(o);const E=t.XpG().$implicit,g=t.XpG();return t.Njj(g.deleteFile(E))}),t.EFF(1,"delete"),t.k0s()}}function U(l,f){if(1&l&&t.DNE(0,R,2,0,"a",14),2&l){const o=t.XpG();t.Y8G("ngIf",!o.locked)}}let x=(()=>{class l{constructor(o,a,E,g){this.httpClient=o,this.confirmDeleteDialog=a,this.fileStorageEntryApi=E,this.userService=g,this.destroyRef=(0,t.WQX)(t.abz),this.locked=!1,this.progress=null,this.form=new u.gE({fileStorageGroupId:new u.MJ("",{nonNullable:!0}),files:new u.MJ([])})}ngOnInit(){this.form.valueChanges.pipe((0,D.B)(200),(0,_.pQ)(this.destroyRef)).subscribe(()=>{this.uploadFiles()})}filter(o){o.fileStorageGroupId=this.fileStorageGroupId}formatSize(o){return s.A.formatBytes(o.sizeBytes)}sasRedirect(o){return c.c.apiHost+"api/file-storage-entry/sas-redirect/"+o.id}uploadFiles(){if(!this.locked&&this.form.value.files&&0!=this.form.value.files.length){this.form.patchValue({fileStorageGroupId:this.fileStorageGroupId},{emitEvent:!1});var o=this.toFormData(this.form.value);this.httpClient.post(c.c.apiHost+"api/file-storage-entry/upload",o,{reportProgress:!0,observe:"events"}).subscribe({next:a=>{a.type===e.hv.UploadProgress&&a.total&&(this.progress=Math.round(100*a.loaded/a.total))},error:a=>{console.log("Error: ",a)},complete:()=>{this.progress=null,this.fileStorageEntryApi.changed.next(null),this.form.patchValue({files:[]},{emitEvent:!1})}})}}toFormData(o){const a=new FormData;var E={};for(const I of Object.keys(o))if("files"==I){var g=o[I];if(g&&g.length)for(var T=0;T<g.length;T++)a.append("file_"+T,g[T])}else E[I]=o[I];return a.append("data",JSON.stringify(E)),a}deleteFile(o){this.locked||this.confirmDeleteDialog.open({title:o.fileName}).subscribe(a=>{this.fileStorageEntryApi.delete({id:o.id},{successGrowl:"File Deleted"}).subscribe(()=>{})})}static{this.\u0275fac=function(a){return new(a||l)(t.rXU(e.Qq),t.rXU(p.K),t.rXU(r.c),t.rXU(i.D))}}static{this.\u0275cmp=t.VBU({type:l,selectors:[["file-browser"]],inputs:{fileStorageGroupId:"fileStorageGroupId",locked:"locked"},decls:16,vars:3,consts:[["itemTemplate",""],[1,"file-list"],[3,"formGroup",4,"ngIf"],[3,"filter","dataSource","search"],["name","filename"],["name","size"],["name","uploadedAt"],["name","uploadedBy"],["justify","right"],[3,"formGroup"],["formControlName","files",3,"showFiles","progress"],["target","blank",1,"link","is-primary",3,"href"],[1,"fas","fa-link"],[4,"ngIf"],["class","link is-danger",3,"click",4,"ngIf"],[1,"link","is-danger",3,"click"]],template:function(a,E){if(1&a){const g=t.RV6();t.j41(0,"div",1),t.DNE(1,O,2,3,"form",2),t.j41(2,"grid",3),t.bIt("filter",function(I){return t.eBV(g),t.Njj(E.filter(I))}),t.j41(3,"grid-column",4),t.DNE(4,F,3,2,"ng-template",null,0,t.C5r),t.k0s(),t.j41(6,"grid-column",5),t.DNE(7,P,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(9,"grid-datetime-column",6),t.j41(10,"grid-column",7),t.DNE(11,y,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.j41(13,"grid-column",8),t.DNE(14,U,1,1,"ng-template",null,0,t.C5r),t.k0s()()()}2&a&&(t.R7$(),t.Y8G("ngIf",!E.locked),t.R7$(),t.Y8G("dataSource",E.fileStorageEntryApi)("search",!0))},dependencies:[d.bT,u.qT,u.BC,u.cb,u.j4,u.JD,m.k,h._,v.C,M.F,d.Jj],encapsulation:2})}}return l})()},3376:(B,C,n)=>{n.d(C,{y:()=>r});var e=n(4438),t=n(1435),_=n(177);function u(i,d){if(1&i){const m=e.RV6();e.j41(0,"a",3),e.bIt("click",function(){e.eBV(m);const v=e.XpG(2);return e.Njj(v.onAdd())}),e.EFF(1,"add"),e.k0s()}}function D(i,d){if(1&i&&e.DNE(0,u,2,0,"a",2),2&i){const m=e.XpG();e.Y8G("ngIf",m.canAdd)}}function s(i,d){if(1&i){const m=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(m);const v=e.XpG().$implicit,M=e.XpG();return e.Njj(M.onEdit(v))}),e.EFF(1,"view/edit"),e.k0s()}}function c(i,d){if(1&i){const m=e.RV6();e.j41(0,"span"),e.EFF(1," \xa0 "),e.j41(2,"a",7),e.bIt("click",function(){e.eBV(m);const v=e.XpG().$implicit,M=e.XpG();return e.Njj(M.onDelete(v))}),e.EFF(3,"delete"),e.k0s()()}}function p(i,d){if(1&i&&e.DNE(0,s,2,0,"a",4)(1,c,4,0,"span",5),2&i){const m=e.XpG();e.Y8G("ngIf",m.canEdit),e.R7$(),e.Y8G("ngIf",m.canDelete)}}let r=(()=>{class i extends t.C{constructor(){super(),this.canAdd=!0,this.add=new e.bkB,this.canEdit=!0,this.edit=new e.bkB,this.canDelete=!0,this.delete=new e.bkB,this.justify="right"}onAdd(){this.add.emit()}onEdit(m){this.edit.emit(m)}onDelete(m){this.delete.emit(m)}static{this.\u0275fac=function(h){return new(h||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["grid-action-column"]],inputs:{canAdd:"canAdd",canEdit:"canEdit",canDelete:"canDelete"},outputs:{add:"add",edit:"edit",delete:"delete"},features:[e.Jv_([{provide:t.C,useExisting:i}]),e.Vt3],decls:4,vars:0,consts:[["headTemplate",""],["itemTemplate",""],["class","link is-success",3,"click",4,"ngIf"],[1,"link","is-success",3,"click"],["class","link is-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(h,v){1&h&&e.DNE(0,D,1,1,"ng-template",null,0,e.C5r)(2,p,2,2,"ng-template",null,1,e.C5r)},dependencies:[_.bT],encapsulation:2})}}return i})()},1050:(B,C,n)=>{n.d(C,{u:()=>D});var e=n(1435),t=n(4438),_=n(177);function u(s,c){if(1&s&&(t.EFF(0),t.nI1(1,"date")),2&s){const p=c.$implicit,r=t.XpG();t.SpI(" ",t.i5U(1,1,p[r.name],"dd MMM yyyy"),"\n")}}let D=(()=>{class s extends e.C{static{this.\u0275fac=(()=>{let p;return function(i){return(p||(p=t.xGo(s)))(i||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["grid-date-column"]],features:[t.Jv_([{provide:e.C,useExisting:s}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(r,i){1&r&&t.DNE(0,u,2,4,"ng-template",null,0,t.C5r)},dependencies:[_.vh],encapsulation:2})}}return s})()},1321:(B,C,n)=>{n.d(C,{F:()=>D});var e=n(1435),t=n(4438),_=n(177);function u(s,c){if(1&s&&(t.EFF(0),t.nI1(1,"date")),2&s){const p=c.$implicit,r=t.XpG();t.SpI(" ",t.i5U(1,1,p[r.name],"dd MMM yyyy HH:mm"),"\n")}}let D=(()=>{class s extends e.C{static{this.\u0275fac=(()=>{let p;return function(i){return(p||(p=t.xGo(s)))(i||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["grid-datetime-column"]],features:[t.Jv_([{provide:e.C,useExisting:s}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(r,i){1&r&&t.DNE(0,u,2,4,"ng-template",null,0,t.C5r)},dependencies:[_.vh],encapsulation:2})}}return s})()},9779:(B,C,n)=>{n.d(C,{h:()=>s});var e=n(1435),t=n(4412),_=n(4438),u=n(177);function D(c,p){if(1&c&&(_.EFF(0),_.nI1(1,"async")),2&c){const r=p.$implicit,i=_.XpG();_.SpI(" ",i.format(_.bMT(1,1,i.lookup(r[i.name]))),"\n")}}let s=(()=>{class c extends e.C{constructor(){super(...arguments),this._cache={}}lookup(r){if(null==this._cache[r]){if(this._cache[r]=new t.t(null),!this.dataSource)return new t.t(null);this.dataSource.query({skip:0,take:1,filters:[{field:"id",op:"eq",value:r}]}).subscribe(i=>{1==i.items.length&&this._cache[r].next(i.items[0])})}return this._cache[r]}format(r){return r?r.name:""}static{this.\u0275fac=(()=>{let r;return function(d){return(r||(r=_.xGo(c)))(d||c)}})()}static{this.\u0275cmp=_.VBU({type:c,selectors:[["grid-reference-column"]],inputs:{dataSource:"dataSource"},features:[_.Jv_([{provide:e.C,useExisting:c}]),_.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(i,d){1&i&&_.DNE(0,D,2,3,"ng-template",null,0,_.C5r)},dependencies:[u.Jj],encapsulation:2})}}return c})()}}]);