"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[883],{9438:(M,E,i)=>{i.d(E,{J:()=>f});var e=i(1626),t=i(4438),m=i(8304),d=i(7520),D=i(4309),l=i(5045),p=i(5312);class f extends d.V{constructor(){super(),this.httpClient=(0,t.WQX)(e.Qq),this.projectSupportApi=(0,t.WQX)(m.n),this.uploadProjectSupportFilesDialog=(0,t.WQX)(l.d),this.attachProjectSupportFilesDialog=(0,t.WQX)(D.n),this.existingFiles=[],this.uploadedFiles=[],this.submitting=!1,this.progress=null}addUploadedFiles(){this.uploadProjectSupportFilesDialog.open({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(o=>{o.uploadedFiles.forEach(a=>{var _=this.uploadedFiles.findIndex(C=>C.name==a.name);_>=0?this.uploadedFiles[_]=a:this.uploadedFiles.push(a)})})}addAttachedFiles(){this.projectSupportApi.selectFile({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(o=>{this.attachProjectSupportFilesDialog.open({databaseFiles:o,existingFiles:this.existingFiles}).subscribe(a=>{this.existingFiles=a.existingFiles})})}removeUploadedFile(o,a){a.preventDefault(),a.stopPropagation();var _=this.uploadedFiles.indexOf(o);-1!==_&&this.uploadedFiles.splice(_,1)}removeExistingFile(o,a){a.preventDefault(),a.stopPropagation();var _=this.existingFiles.indexOf(o);-1!==_&&this.existingFiles.splice(_,1)}submitFiles(){var o=this.toFormData();null!=o?this.httpClient.post(p.c.apiHost+"api/project-support/upload-file",o,{reportProgress:!0,observe:"events"}).subscribe({next:a=>{if(a.type===e.hv.UploadProgress&&a.total&&(this.progress=Math.round(100*a.loaded/a.total)),a.type===e.hv.Response){console.log(a);var _=a.body;this.uploadedFiles=[],this.existingFiles=this.existingFiles.concat(_),this.submitForm()}},error:a=>{this.fileSubmissionError(a)}}):this.submitForm()}toFormData(){if(!this.uploadedFiles||!this.uploadedFiles.length)return null;const o=new FormData;for(var a=0;a<this.uploadedFiles.length;a++)o.append("file_"+a,this.uploadedFiles[a]);return o.append("data",JSON.stringify({projectSupportGroupId:this.data.projectSupportGroupId})),o}fileSubmissionError(o){this.submitting=!1,this.progress=null,console.log("File Submission Error: ",o),alert("There was an error uploading your files.\n\nPlease ensure all files are saved on your computer, and not open in another application.")}}},6129:(M,E,i)=>{i.d(E,{A:()=>l});var e=i(4438),t=i(2474),m=i(4722),d=i(3548),D=i(8933);let l=(()=>{class p{constructor(){this.route=(0,e.WQX)(m.nX),this.router=(0,e.WQX)(m.Ix),this.projectApi=(0,e.WQX)(t.A),this.confirmDialog=(0,e.WQX)(D.T),this.staticDataCache=(0,e.WQX)(d.t),this.projectStatus=null}ngOnInit(){this.reset(this.route.snapshot.data.project)}reset(r){this.item=r,this.resetStatus()}resetStatus(){this.staticDataCache.projectStatus.get({id:this.item.statusId}).subscribe(r=>{this.projectStatus=r,this.locked?this.applyLock():this.clearLock()})}applyLock(){}clearLock(){}get locked(){return this.item.locked}get discarded(){return this.item.discarded}unlock(){this.confirmDialog.open({title:"Unlock Project",message:"Are you sure you want to return this project to Active status?"}).subscribe(()=>{this.projectApi.unlock({id:this.item.id},{successGrowl:"Project Unlocked"}).subscribe(r=>{this.reset(r)})})}static{this.\u0275fac=function(o){return new(o||p)}}static{this.\u0275cmp=e.VBU({type:p,selectors:[["ng-component"]],decls:0,vars:0,template:function(o,a){},encapsulation:2})}}return p})()},6628:(M,E,i)=>{i.d(E,{w:()=>N});var e=i(1626),t=i(4438),m=i(9079),d=i(4341),D=i(152),l=i(9636),p=i(5312),f=i(4722),r=i(4247),o=i(7941),a=i(3916),_=i(4312),C=i(3548),F=i(177),P=i(2817),T=i(9011),B=i(1062),O=i(1435),j=i(1321);const A=s=>({id:s});function G(s,h){if(1&s&&(t.j41(0,"form",18),t.nrm(1,"file-input",19),t.k0s()),2&s){const n=t.XpG();t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("showFiles",!1)("progress",n.progress)}}function R(s,h){if(1&s&&(t.j41(0,"span",23),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&s){let n;const c=h.$implicit,u=t.XpG(3);t.R7$(),t.JRh(null==(n=t.bMT(2,1,u.staticDataCache.fileTag.get(t.eq3(3,A,c))))?null:n.name)}}function x(s,h){if(1&s&&(t.j41(0,"div",22),t.Z7z(1,R,3,5,"span",23,t.fX1),t.k0s()),2&s){const n=t.XpG().$implicit;t.R7$(),t.Dyx(n.fileTagIds)}}function U(s,h){if(1&s&&(t.j41(0,"a",20),t.nrm(1,"i",21),t.EFF(2),t.k0s(),t.DNE(3,x,3,0,"div",22)),2&s){const n=h.$implicit,c=t.XpG();t.FS9("href",c.sasRedirect(n),t.B4B),t.R7$(2),t.SpI("\xa0",n.fileName,""),t.R7$(),t.vxM(3,n.fileTagIds&&n.fileTagIds.length>0?3:-1)}}function y(s,h){if(1&s&&t.EFF(0),2&s){const n=h.$implicit,c=t.XpG();t.SpI(" ",c.formatSize(n)," ")}}function S(s,h){1&s&&(t.j41(0,"div")(1,"i"),t.EFF(2,"Support Request Form"),t.k0s()())}function k(s,h){if(1&s&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&s){const n=t.XpG().$implicit,c=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,c.userService.formatUser(n.uploadedByUserId))," ")}}function W(s,h){if(1&s&&t.DNE(0,S,3,0,"div",24)(1,k,3,3,"div",24),2&s){const n=h.$implicit;t.Y8G("ngIf",null===n.uploadedByUserId),t.R7$(),t.Y8G("ngIf",null!==n.uploadedByUserId)}}function L(s,h){if(1&s){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,g=t.XpG();return t.Njj(g.editFile(u))}),t.EFF(1,"edit tags"),t.k0s()}}function K(s,h){if(1&s){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,g=t.XpG();return t.Njj(g.searchSupport(u))}),t.EFF(1,"search support"),t.k0s()}}function X(s,h){if(1&s){const n=t.RV6();t.j41(0,"a",28),t.bIt("click",function(){t.eBV(n);const u=t.XpG().$implicit,g=t.XpG();return t.Njj(g.deleteFile(u))}),t.EFF(1,"delete"),t.k0s()}}function b(s,h){if(1&s&&(t.DNE(0,L,2,0,"a",25),t.EFF(1," \xa0|\xa0 "),t.DNE(2,K,2,0,"a",25),t.EFF(3," \xa0|\xa0 "),t.DNE(4,X,2,0,"a",26)),2&s){const n=t.XpG();t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked)}}let N=(()=>{class s{constructor(n,c,u,g,I,v,V){this.router=n,this.httpClient=c,this.confirmDeleteDialog=u,this.fileEditorDialog=g,this.fileStorageEntryApi=I,this.userService=v,this.staticDataCache=V,this.destroyRef=(0,t.WQX)(t.abz),this.projectId=null,this.locked=!1,this.filterForm=new d.gE({search:new d.MJ("",{nonNullable:!0}),fileTagId:new d.MJ(null)}),this.progress=null,this.form=new d.gE({fileStorageGroupId:new d.MJ("",{nonNullable:!0}),files:new d.MJ([])})}ngOnInit(){this.form.valueChanges.pipe((0,D.B)(200),(0,m.pQ)(this.destroyRef)).subscribe(()=>{this.uploadFiles()})}resetFilterForm(){this.filterForm.patchValue({search:"",fileTagId:null})}filter(n){n.fileStorageGroupId=this.fileStorageGroupId}formatSize(n){return l.A.formatBytes(n.sizeBytes)}sasRedirect(n){return p.c.apiHost+"api/file-storage-entry/sas-redirect/"+n.id}uploadFiles(){if(!this.locked&&this.form.value.files&&0!=this.form.value.files.length){this.form.patchValue({fileStorageGroupId:this.fileStorageGroupId},{emitEvent:!1});var n=this.toFormData(this.form.value);this.httpClient.post(p.c.apiHost+"api/file-storage-entry/upload",n,{reportProgress:!0,observe:"events"}).subscribe({next:c=>{c.type===e.hv.UploadProgress&&c.total&&(this.progress=Math.round(100*c.loaded/c.total))},error:c=>{console.log("Error: ",c)},complete:()=>{this.progress=null,this.fileStorageEntryApi.changed.next(null),this.form.patchValue({files:[]},{emitEvent:!1})}})}}toFormData(n){const c=new FormData;var u={};for(const v of Object.keys(n))if("files"==v){var g=n[v];if(g&&g.length)for(var I=0;I<g.length;I++)c.append("file_"+I,g[I])}else u[v]=n[v];return c.append("data",JSON.stringify(u)),c}deleteFile(n){this.locked||this.confirmDeleteDialog.open({title:n.fileName}).subscribe(c=>{this.fileStorageEntryApi.delete({id:n.id},{successGrowl:"File Deleted"}).subscribe(()=>{})})}editFile(n){this.locked||this.fileEditorDialog.open({file:n}).subscribe(()=>{})}searchSupport(n){l.A.setLocalStorage("SupportFileSearch",n.fileName),null!==this.projectId&&this.router.navigateByUrl(`/project/project-support/${this.projectId}`)}static{this.\u0275fac=function(c){return new(c||s)(t.rXU(f.Ix),t.rXU(e.Qq),t.rXU(r.K),t.rXU(o.U),t.rXU(a.c),t.rXU(_.D),t.rXU(C.t))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["file-browser"]],inputs:{fileStorageGroupId:"fileStorageGroupId",projectId:"projectId",locked:"locked"},decls:27,vars:8,consts:[["itemTemplate",""],[1,"file-list"],[3,"formGroup",4,"ngIf"],[1,"filter-form"],[1,"form",3,"formGroup"],[1,"flex"],[1,"field","is-9"],["type","text","formControlName","search","placeholder","Search",1,"input"],[1,"field","is-3"],["placeholder","Tag","formControlName","fileTagId",3,"dataSource","enableClear","enableSearch"],[1,"is-12","is-right"],[1,"button","is-small",3,"click"],[3,"filter","dataSource","filterForm","take"],["name","filename"],["name","size"],["name","uploadedAt"],["name","uploadedBy"],["justify","right"],[3,"formGroup"],["formControlName","files",3,"showFiles","progress"],["target","blank",1,"link","is-primary",3,"href"],[1,"fas","fa-link"],[1,"tags",2,"margin-top","0.5rem","max-width","500px"],[1,"tag","is-small"],[4,"ngIf"],["class","link is-primary",3,"click",4,"ngIf"],["class","link is-danger",3,"click",4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(c,u){if(1&c){const g=t.RV6();t.j41(0,"div",1),t.DNE(1,G,2,3,"form",2),t.j41(2,"div",3)(3,"form",4)(4,"div",5)(5,"div",6),t.nrm(6,"input",7),t.k0s(),t.j41(7,"div",8),t.nrm(8,"dropdown-select",9),t.k0s()(),t.j41(9,"div",5)(10,"div",10)(11,"button",11),t.bIt("click",function(){return t.eBV(g),t.Njj(u.resetFilterForm())}),t.EFF(12,"show all"),t.k0s()()()()(),t.j41(13,"grid",12),t.bIt("filter",function(v){return t.eBV(g),t.Njj(u.filter(v))}),t.j41(14,"grid-column",13),t.DNE(15,U,4,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(17,"grid-column",14),t.DNE(18,y,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(20,"grid-datetime-column",15),t.j41(21,"grid-column",16),t.DNE(22,W,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.j41(24,"grid-column",17),t.DNE(25,b,5,3,"ng-template",null,0,t.C5r),t.k0s()()()}2&c&&(t.R7$(),t.Y8G("ngIf",!u.locked),t.R7$(2),t.Y8G("formGroup",u.filterForm),t.R7$(5),t.Y8G("dataSource",u.staticDataCache.fileTag)("enableClear",!0)("enableSearch",!0),t.R7$(5),t.Y8G("dataSource",u.fileStorageEntryApi)("filterForm",u.filterForm)("take",100))},dependencies:[F.bT,d.qT,d.me,d.BC,d.cb,d.j4,d.JD,P.p,T.k,B._,O.C,j.F,F.Jj],encapsulation:2})}}return s})()},3376:(M,E,i)=>{i.d(E,{y:()=>r});var e=i(4438),t=i(1435),m=i(177);function d(o,a){if(1&o){const _=e.RV6();e.j41(0,"a",3),e.bIt("click",function(){e.eBV(_);const F=e.XpG(2);return e.Njj(F.onAdd())}),e.EFF(1,"add"),e.k0s()}}function D(o,a){if(1&o&&e.DNE(0,d,2,0,"a",2),2&o){const _=e.XpG();e.Y8G("ngIf",_.canAdd)}}function l(o,a){if(1&o){const _=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(_);const F=e.XpG().$implicit,P=e.XpG();return e.Njj(P.onEdit(F))}),e.EFF(1,"view/edit"),e.k0s()}}function p(o,a){if(1&o){const _=e.RV6();e.j41(0,"span"),e.EFF(1," \xa0 "),e.j41(2,"a",7),e.bIt("click",function(){e.eBV(_);const F=e.XpG().$implicit,P=e.XpG();return e.Njj(P.onDelete(F))}),e.EFF(3,"delete"),e.k0s()()}}function f(o,a){if(1&o&&e.DNE(0,l,2,0,"a",4)(1,p,4,0,"span",5),2&o){const _=e.XpG();e.Y8G("ngIf",_.canEdit),e.R7$(),e.Y8G("ngIf",_.canDelete)}}let r=(()=>{class o extends t.C{constructor(){super(),this.canAdd=!0,this.add=new e.bkB,this.canEdit=!0,this.edit=new e.bkB,this.canDelete=!0,this.delete=new e.bkB,this.justify="right"}onAdd(){this.add.emit()}onEdit(_){this.edit.emit(_)}onDelete(_){this.delete.emit(_)}static{this.\u0275fac=function(C){return new(C||o)}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["grid-action-column"]],inputs:{canAdd:"canAdd",canEdit:"canEdit",canDelete:"canDelete"},outputs:{add:"add",edit:"edit",delete:"delete"},features:[e.Jv_([{provide:t.C,useExisting:o}]),e.Vt3],decls:4,vars:0,consts:[["headTemplate",""],["itemTemplate",""],["class","link is-success",3,"click",4,"ngIf"],[1,"link","is-success",3,"click"],["class","link is-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(C,F){1&C&&e.DNE(0,D,1,1,"ng-template",null,0,e.C5r)(2,f,2,2,"ng-template",null,1,e.C5r)},dependencies:[m.bT],encapsulation:2})}}return o})()},1050:(M,E,i)=>{i.d(E,{u:()=>D});var e=i(1435),t=i(4438),m=i(177);function d(l,p){if(1&l&&(t.EFF(0),t.nI1(1,"date")),2&l){const f=p.$implicit,r=t.XpG();t.SpI(" ",t.i5U(1,1,f[r.name],"dd MMM yyyy"),"\n")}}let D=(()=>{class l extends e.C{static{this.\u0275fac=(()=>{let f;return function(o){return(f||(f=t.xGo(l)))(o||l)}})()}static{this.\u0275cmp=t.VBU({type:l,selectors:[["grid-date-column"]],features:[t.Jv_([{provide:e.C,useExisting:l}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(r,o){1&r&&t.DNE(0,d,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return l})()},1321:(M,E,i)=>{i.d(E,{F:()=>D});var e=i(1435),t=i(4438),m=i(177);function d(l,p){if(1&l&&(t.EFF(0),t.nI1(1,"date")),2&l){const f=p.$implicit,r=t.XpG();t.SpI(" ",t.i5U(1,1,f[r.name],"dd MMM yyyy HH:mm"),"\n")}}let D=(()=>{class l extends e.C{static{this.\u0275fac=(()=>{let f;return function(o){return(f||(f=t.xGo(l)))(o||l)}})()}static{this.\u0275cmp=t.VBU({type:l,selectors:[["grid-datetime-column"]],features:[t.Jv_([{provide:e.C,useExisting:l}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(r,o){1&r&&t.DNE(0,d,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return l})()},9779:(M,E,i)=>{i.d(E,{h:()=>l});var e=i(1435),t=i(4412),m=i(4438),d=i(177);function D(p,f){if(1&p&&(m.EFF(0),m.nI1(1,"async")),2&p){const r=f.$implicit,o=m.XpG();m.SpI(" ",o.format(m.bMT(1,1,o.lookup(r[o.name]))),"\n")}}let l=(()=>{class p extends e.C{constructor(){super(...arguments),this._cache={}}lookup(r){if(null==this._cache[r]){if(this._cache[r]=new t.t(null),!this.dataSource)return new t.t(null);this.dataSource.query({skip:0,take:1,filters:[{field:"id",op:"eq",value:r}]}).subscribe(o=>{1==o.items.length&&this._cache[r].next(o.items[0])})}return this._cache[r]}format(r){return r?r.name:""}static{this.\u0275fac=(()=>{let r;return function(a){return(r||(r=m.xGo(p)))(a||p)}})()}static{this.\u0275cmp=m.VBU({type:p,selectors:[["grid-reference-column"]],inputs:{dataSource:"dataSource"},features:[m.Jv_([{provide:e.C,useExisting:p}]),m.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(o,a){1&o&&m.DNE(0,D,2,3,"ng-template",null,0,m.C5r)},dependencies:[d.Jj],encapsulation:2})}}return p})()}}]);