"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[965],{6628:(v,F,o)=>{o.d(F,{w:()=>L});var n=o(1626),e=o(4438),I=o(9079),_=o(4341),T=o(152),p=o(9636),C=o(5312),d=o(4722),f=o(4247),r=o(7941),D=o(3916),s=o(4312),g=o(3548),u=o(177),B=o(2817),G=o(9011),M=o(1062),k=o(1435),A=o(1321);const O=i=>({id:i});function j(i,c){if(1&i&&(e.j41(0,"form",18),e.nrm(1,"file-input",19),e.k0s()),2&i){const t=e.XpG();e.Y8G("formGroup",t.form),e.R7$(),e.Y8G("showFiles",!1)("progress",t.progress)}}function P(i,c){if(1&i&&(e.j41(0,"span",23),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&i){let t;const l=c.$implicit,a=e.XpG(3);e.R7$(),e.JRh(null==(t=e.bMT(2,1,a.staticDataCache.fileTag.get(e.eq3(3,O,l))))?null:t.name)}}function R(i,c){if(1&i&&(e.j41(0,"div",22),e.Z7z(1,P,3,5,"span",23,e.fX1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Dyx(t.fileTagIds)}}function y(i,c){if(1&i&&(e.j41(0,"a",20),e.nrm(1,"i",21),e.EFF(2),e.k0s(),e.DNE(3,R,3,0,"div",22)),2&i){const t=c.$implicit,l=e.XpG();e.FS9("href",l.sasRedirect(t),e.B4B),e.R7$(2),e.SpI("\xa0",t.fileName,""),e.R7$(),e.vxM(3,t.fileTagIds&&t.fileTagIds.length>0?3:-1)}}function U(i,c){if(1&i&&e.EFF(0),2&i){const t=c.$implicit,l=e.XpG();e.SpI(" ",l.formatSize(t)," ")}}function x(i,c){1&i&&(e.j41(0,"div")(1,"i"),e.EFF(2,"Support Request Form"),e.k0s()())}function S(i,c){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&i){const t=e.XpG().$implicit,l=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,l.userService.formatUser(t.uploadedByUserId))," ")}}function N(i,c){if(1&i&&e.DNE(0,x,3,0,"div",24)(1,S,3,3,"div",24),2&i){const t=c.$implicit;e.Y8G("ngIf",null===t.uploadedByUserId),e.R7$(),e.Y8G("ngIf",null!==t.uploadedByUserId)}}function X(i,c){if(1&i){const t=e.RV6();e.j41(0,"a",27),e.bIt("click",function(){e.eBV(t);const a=e.XpG().$implicit,m=e.XpG();return e.Njj(m.editFile(a))}),e.EFF(1,"edit tags"),e.k0s()}}function $(i,c){if(1&i){const t=e.RV6();e.j41(0,"span"),e.EFF(1," \xa0|\xa0 "),e.j41(2,"a",27),e.bIt("click",function(){e.eBV(t);const a=e.XpG().$implicit,m=e.XpG();return e.Njj(m.searchSupport(a))}),e.EFF(3,"search support"),e.k0s()()}}function b(i,c){if(1&i){const t=e.RV6();e.j41(0,"a",28),e.bIt("click",function(){e.eBV(t);const a=e.XpG().$implicit,m=e.XpG();return e.Njj(m.deleteFile(a))}),e.EFF(1,"delete"),e.k0s()}}function K(i,c){if(1&i&&(e.DNE(0,X,2,0,"a",25)(1,$,4,0,"span",24),e.EFF(2," \xa0|\xa0 "),e.DNE(3,b,2,0,"a",26)),2&i){const t=e.XpG();e.Y8G("ngIf",!t.locked),e.R7$(),e.Y8G("ngIf",!t.locked&&!t.isGlobalFiles()),e.R7$(2),e.Y8G("ngIf",!t.locked)}}let L=(()=>{class i{constructor(t,l,a,m,E,h,W){this.router=t,this.httpClient=l,this.confirmDeleteDialog=a,this.fileEditorDialog=m,this.fileStorageEntryApi=E,this.userService=h,this.staticDataCache=W,this.destroyRef=(0,e.WQX)(e.abz),this.globalFileStorageGroupId="17c28098-375c-4a1a-bc41-43813786ab84",this.projectId=null,this.locked=!1,this.filterForm=new _.gE({search:new _.MJ("",{nonNullable:!0}),fileTagId:new _.MJ(null)}),this.progress=null,this.form=new _.gE({fileStorageGroupId:new _.MJ("",{nonNullable:!0}),files:new _.MJ([])})}ngOnInit(){this.form.valueChanges.pipe((0,T.B)(200),(0,I.pQ)(this.destroyRef)).subscribe(()=>{this.uploadFiles()})}isGlobalFiles(){return this.fileStorageGroupId==this.globalFileStorageGroupId}resetFilterForm(){this.filterForm.patchValue({search:"",fileTagId:null})}filter(t){t.fileStorageGroupId=this.fileStorageGroupId}formatSize(t){return p.A.formatBytes(t.sizeBytes)}sasRedirect(t){return C.c.apiHost+"api/file-storage-entry/sas-redirect/"+t.id}uploadFiles(){if(!this.locked&&this.form.value.files&&0!=this.form.value.files.length){this.form.patchValue({fileStorageGroupId:this.fileStorageGroupId},{emitEvent:!1});var t=this.toFormData(this.form.value);this.httpClient.post(C.c.apiHost+"api/file-storage-entry/upload",t,{reportProgress:!0,observe:"events"}).subscribe({next:l=>{l.type===n.hv.UploadProgress&&l.total&&(this.progress=Math.round(100*l.loaded/l.total))},error:l=>{console.log("Error: ",l)},complete:()=>{this.progress=null,this.fileStorageEntryApi.changed.next(null),this.form.patchValue({files:[]},{emitEvent:!1})}})}}toFormData(t){const l=new FormData;var a={};for(const h of Object.keys(t))if("files"==h){var m=t[h];if(m&&m.length)for(var E=0;E<m.length;E++)l.append("file_"+E,m[E])}else a[h]=t[h];return l.append("data",JSON.stringify(a)),l}deleteFile(t){this.locked||this.confirmDeleteDialog.open({title:t.fileName}).subscribe(l=>{this.fileStorageEntryApi.delete({id:t.id},{successGrowl:"File Deleted"}).subscribe(()=>{})})}editFile(t){this.locked||this.fileEditorDialog.open({file:t}).subscribe(()=>{})}searchSupport(t){p.A.setLocalStorage("SupportFileSearch",t.fileName),null!==this.projectId&&this.router.navigateByUrl(`/project/project-support/${this.projectId}`)}static{this.\u0275fac=function(l){return new(l||i)(e.rXU(d.Ix),e.rXU(n.Qq),e.rXU(f.K),e.rXU(r.U),e.rXU(D.c),e.rXU(s.D),e.rXU(g.t))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["file-browser"]],inputs:{fileStorageGroupId:"fileStorageGroupId",projectId:"projectId",locked:"locked"},decls:27,vars:8,consts:[["itemTemplate",""],[1,"file-list"],[3,"formGroup",4,"ngIf"],[1,"filter-form"],[1,"form",3,"formGroup"],[1,"flex"],[1,"field","is-9"],["type","text","formControlName","search","placeholder","Search",1,"input"],[1,"field","is-3"],["placeholder","Tag","formControlName","fileTagId",3,"dataSource","enableClear","enableSearch"],[1,"is-12","is-right"],[1,"button","is-small",3,"click"],[3,"filter","dataSource","filterForm","take"],["name","filename"],["name","size"],["name","uploadedAt"],["name","uploadedBy"],["justify","right"],[3,"formGroup"],["formControlName","files",3,"showFiles","progress"],["target","blank",1,"link","is-primary",3,"href"],[1,"fas","fa-link"],[1,"tags",2,"margin-top","0.5rem","max-width","500px"],[1,"tag","is-small"],[4,"ngIf"],["class","link is-primary",3,"click",4,"ngIf"],["class","link is-danger",3,"click",4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(l,a){if(1&l){const m=e.RV6();e.j41(0,"div",1),e.DNE(1,j,2,3,"form",2),e.j41(2,"div",3)(3,"form",4)(4,"div",5)(5,"div",6),e.nrm(6,"input",7),e.k0s(),e.j41(7,"div",8),e.nrm(8,"dropdown-select",9),e.k0s()(),e.j41(9,"div",5)(10,"div",10)(11,"button",11),e.bIt("click",function(){return e.eBV(m),e.Njj(a.resetFilterForm())}),e.EFF(12,"show all"),e.k0s()()()()(),e.j41(13,"grid",12),e.bIt("filter",function(h){return e.eBV(m),e.Njj(a.filter(h))}),e.j41(14,"grid-column",13),e.DNE(15,y,4,3,"ng-template",null,0,e.C5r),e.k0s(),e.j41(17,"grid-column",14),e.DNE(18,U,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.nrm(20,"grid-datetime-column",15),e.j41(21,"grid-column",16),e.DNE(22,N,2,2,"ng-template",null,0,e.C5r),e.k0s(),e.j41(24,"grid-column",17),e.DNE(25,K,4,3,"ng-template",null,0,e.C5r),e.k0s()()()}2&l&&(e.R7$(),e.Y8G("ngIf",!a.locked),e.R7$(2),e.Y8G("formGroup",a.filterForm),e.R7$(5),e.Y8G("dataSource",a.staticDataCache.fileTag)("enableClear",!0)("enableSearch",!0),e.R7$(5),e.Y8G("dataSource",a.fileStorageEntryApi)("filterForm",a.filterForm)("take",100))},dependencies:[u.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,B.p,G.k,M._,k.C,A.F,u.Jj],encapsulation:2})}}return i})()},3376:(v,F,o)=>{o.d(F,{y:()=>f});var n=o(4438),e=o(1435),I=o(177);function _(r,D){if(1&r){const s=n.RV6();n.j41(0,"a",3),n.bIt("click",function(){n.eBV(s);const u=n.XpG(2);return n.Njj(u.onAdd())}),n.EFF(1,"add"),n.k0s()}}function T(r,D){if(1&r&&n.DNE(0,_,2,0,"a",2),2&r){const s=n.XpG();n.Y8G("ngIf",s.canAdd)}}function p(r,D){if(1&r){const s=n.RV6();n.j41(0,"a",6),n.bIt("click",function(){n.eBV(s);const u=n.XpG().$implicit,B=n.XpG();return n.Njj(B.onEdit(u))}),n.EFF(1,"view/edit"),n.k0s()}}function C(r,D){if(1&r){const s=n.RV6();n.j41(0,"span")(1,"a",7),n.bIt("click",function(){n.eBV(s);const u=n.XpG().$implicit,B=n.XpG();return n.Njj(B.onDelete(u))}),n.EFF(2,"delete"),n.k0s()()}}function d(r,D){if(1&r&&(n.DNE(0,p,2,0,"a",4),n.EFF(1,"\xa0"),n.DNE(2,C,3,0,"span",5)),2&r){const s=n.XpG();n.Y8G("ngIf",s.canEdit),n.R7$(2),n.Y8G("ngIf",s.canDelete)}}let f=(()=>{class r extends e.C{constructor(){super(),this.canAdd=!0,this.add=new n.bkB,this.canEdit=!0,this.edit=new n.bkB,this.canDelete=!0,this.delete=new n.bkB,this.justify="right"}onAdd(){this.add.emit()}onEdit(s){this.edit.emit(s)}onDelete(s){this.delete.emit(s)}static{this.\u0275fac=function(g){return new(g||r)}}static{this.\u0275cmp=n.VBU({type:r,selectors:[["grid-action-column"]],inputs:{canAdd:"canAdd",canEdit:"canEdit",canDelete:"canDelete"},outputs:{add:"add",edit:"edit",delete:"delete"},features:[n.Jv_([{provide:e.C,useExisting:r}]),n.Vt3],decls:4,vars:0,consts:[["headTemplate",""],["itemTemplate",""],["class","link is-success",3,"click",4,"ngIf"],[1,"link","is-success",3,"click"],["class","link is-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(g,u){1&g&&n.DNE(0,T,1,1,"ng-template",null,0,n.C5r)(2,d,3,2,"ng-template",null,1,n.C5r)},dependencies:[I.bT],encapsulation:2})}}return r})()},1321:(v,F,o)=>{o.d(F,{F:()=>T});var n=o(1435),e=o(4438),I=o(177);function _(p,C){if(1&p&&(e.EFF(0),e.nI1(1,"date")),2&p){const d=C.$implicit,f=e.XpG();e.SpI(" ",e.i5U(1,1,d[f.name],"dd MMM yyyy HH:mm"),"\n")}}let T=(()=>{class p extends n.C{static{this.\u0275fac=(()=>{let d;return function(r){return(d||(d=e.xGo(p)))(r||p)}})()}static{this.\u0275cmp=e.VBU({type:p,selectors:[["grid-datetime-column"]],features:[e.Jv_([{provide:n.C,useExisting:p}]),e.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(f,r){1&f&&e.DNE(0,_,2,4,"ng-template",null,0,e.C5r)},dependencies:[I.vh],encapsulation:2})}}return p})()}}]);