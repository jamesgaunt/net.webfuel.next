"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[76],{9438:(f,c,s)=>{s.d(c,{J:()=>e});var u=s(1626),t=s(4438),r=s(8304),_=s(7520),m=s(4309),a=s(8933),p=s(5045),i=s(5312);class e extends _.V{constructor(){super(),this.httpClient=(0,t.WQX)(u.Qq),this.projectSupportApi=(0,t.WQX)(r.n),this.uploadProjectSupportFilesDialog=(0,t.WQX)(p.d),this.attachProjectSupportFilesDialog=(0,t.WQX)(m.n),this.confirmDialog=(0,t.WQX)(a.T),this.existingFiles=[],this.uploadedFiles=[],this.submitting=!1,this.progress=null}addUploadedFiles(){this.uploadProjectSupportFilesDialog.open({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(n=>{n.uploadedFiles.forEach(o=>{var d=this.uploadedFiles.findIndex(h=>h.name==o.name);d>=0?this.uploadedFiles[d]=o:this.uploadedFiles.push(o)})})}addAttachedFiles(){this.projectSupportApi.selectFile({projectSupportGroupId:this.data.projectSupportGroupId}).subscribe(n=>{this.attachProjectSupportFilesDialog.open({databaseFiles:n,existingFiles:this.existingFiles}).subscribe(o=>{this.existingFiles=o.existingFiles})})}removeUploadedFile(n,o){o.preventDefault(),o.stopPropagation();var d=this.uploadedFiles.indexOf(n);-1!==d&&this.uploadedFiles.splice(d,1)}removeExistingFile(n,o){o.preventDefault(),o.stopPropagation(),this.confirmDialog.open({title:"Delete Existing Attached File",message:"Are you sure you want to remove this file from this support item?<br/><br/><b>Note:</b> This only removes the link. To permanently delete the file, you will need to delete it separately from the Files tab."}).subscribe(d=>{if(d){var h=this.existingFiles.indexOf(n);-1!==h&&this.existingFiles.splice(h,1)}})}submitFiles(){var n=this.toFormData();null!=n?this.httpClient.post(i.c.apiHost+"api/project-support/upload-file",n,{reportProgress:!0,observe:"events"}).subscribe({next:o=>{if(o.type===u.hv.UploadProgress&&o.total&&(this.progress=Math.round(100*o.loaded/o.total)),o.type===u.hv.Response){console.log(o);var d=o.body;this.uploadedFiles=[],this.existingFiles=this.existingFiles.concat(d),this.submitForm()}},error:o=>{this.fileSubmissionError(o)}}):this.submitForm()}toFormData(){if(!this.uploadedFiles||!this.uploadedFiles.length)return null;const n=new FormData;for(var o=0;o<this.uploadedFiles.length;o++)n.append("file_"+o,this.uploadedFiles[o]);return n.append("data",JSON.stringify({projectSupportGroupId:this.data.projectSupportGroupId})),n}fileSubmissionError(n){this.submitting=!1,this.progress=null,console.log("File Submission Error: ",n),alert("There was an error uploading your files.\n\nPlease ensure all files are saved on your computer, and not open in another application.")}}},1512:(f,c,s)=>{s.d(c,{s:()=>p});var u=s(1435),t=s(4438),r=s(177);function _(i,e){1&i&&t.nrm(0,"span",3)}function m(i,e){1&i&&t.nrm(0,"span",4)}function a(i,e){if(1&i&&t.DNE(0,_,1,0,"span",1)(1,m,1,0,"span",2),2&i){const l=e.$implicit,n=t.XpG();t.Y8G("ngIf",l[n.name]),t.R7$(),t.Y8G("ngIf",!l[n.name])}}let p=(()=>{class i extends u.C{constructor(){super(),this.justify="center"}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["grid-boolean-column"]],features:[t.Jv_([{provide:u.C,useExisting:i}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""],["class","fas fa-check",4,"ngIf"],["class","fas fa-times","style","opacity: 0.2;",4,"ngIf"],[1,"fas","fa-check"],[1,"fas","fa-times",2,"opacity","0.2"]],template:function(n,o){1&n&&t.DNE(0,a,2,2,"ng-template",null,0,t.C5r)},dependencies:[r.bT],encapsulation:2})}}return i})()},1050:(f,c,s)=>{s.d(c,{u:()=>m});var u=s(1435),t=s(4438),r=s(177);function _(a,p){if(1&a&&(t.EFF(0),t.nI1(1,"date")),2&a){const i=p.$implicit,e=t.XpG();t.SpI(" ",t.i5U(1,1,i[e.name],"dd MMM yyyy"),"\n")}}let m=(()=>{class a extends u.C{static{this.\u0275fac=(()=>{let i;return function(l){return(i||(i=t.xGo(a)))(l||a)}})()}static{this.\u0275cmp=t.VBU({type:a,selectors:[["grid-date-column"]],features:[t.Jv_([{provide:u.C,useExisting:a}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(e,l){1&e&&t.DNE(0,_,2,4,"ng-template",null,0,t.C5r)},dependencies:[r.vh],encapsulation:2})}}return a})()},8009:(f,c,s)=>{s.d(c,{R:()=>m});var u=s(1435),t=s(4438),r=s(177);function _(a,p){if(1&a&&(t.EFF(0),t.nI1(1,"number")),2&a){const i=p.$implicit,e=t.XpG();t.Lme(" ",e.prefix,"",t.i5U(1,2,i[e.name],e.format),"\n")}}let m=(()=>{class a extends u.C{constructor(){super(),this.format="1.0-0",this.prefix="",this.justify="right"}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["grid-number-column"]],inputs:{format:"format",prefix:"prefix"},features:[t.Jv_([{provide:u.C,useExisting:a}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(e,l){1&e&&t.DNE(0,_,2,5,"ng-template",null,0,t.C5r)},dependencies:[r.QX],encapsulation:2})}}return a})()},9779:(f,c,s)=>{s.d(c,{h:()=>a});var u=s(1435),t=s(4412),r=s(4438),_=s(177);function m(p,i){if(1&p&&(r.EFF(0),r.nI1(1,"async")),2&p){const e=i.$implicit,l=r.XpG();r.SpI(" ",l.format(r.bMT(1,1,l.lookup(e[l.name]))),"\n")}}let a=(()=>{class p extends u.C{constructor(){super(...arguments),this._cache={}}lookup(e){if(null==this._cache[e]){if(this._cache[e]=new t.t(null),!this.dataSource)return new t.t(null);this.dataSource.query({skip:0,take:1,filters:[{field:"id",op:"eq",value:e}]}).subscribe(l=>{1==l.items.length&&this._cache[e].next(l.items[0])})}return this._cache[e]}format(e){return e?e.name:""}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.xGo(p)))(n||p)}})()}static{this.\u0275cmp=r.VBU({type:p,selectors:[["grid-reference-column"]],inputs:{dataSource:"dataSource"},features:[r.Jv_([{provide:u.C,useExisting:p}]),r.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(l,n){1&l&&r.DNE(0,m,2,3,"ng-template",null,0,r.C5r)},dependencies:[_.Jj],encapsulation:2})}}return p})()}}]);