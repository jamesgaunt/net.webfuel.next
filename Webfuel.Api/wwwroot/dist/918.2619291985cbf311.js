"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[918],{6628:(B,E,i)=>{i.d(E,{w:()=>$});var e=i(1626),t=i(4438),m=i(9079),_=i(4341),h=i(152),s=i(9636),p=i(5312),u=i(4722),a=i(4247),r=i(7941),C=i(3916),d=i(4312),F=i(3548),D=i(177),v=i(2817),M=i(9011),G=i(1062),O=i(1435),P=i(1321);const R=o=>({id:o});function A(o,f){if(1&o&&(t.j41(0,"form",18),t.nrm(1,"file-input",19),t.k0s()),2&o){const n=t.XpG();t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("showFiles",!1)("progress",n.progress)}}function y(o,f){if(1&o&&(t.j41(0,"span",23),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&o){let n;const l=f.$implicit,c=t.XpG(3);t.R7$(),t.JRh(null==(n=t.bMT(2,1,c.staticDataCache.fileTag.get(t.eq3(3,R,l))))?null:n.name)}}function j(o,f){if(1&o&&(t.j41(0,"div",22),t.Z7z(1,y,3,5,"span",23,t.fX1),t.k0s()),2&o){const n=t.XpG().$implicit;t.R7$(),t.Dyx(n.fileTagIds)}}function k(o,f){if(1&o&&(t.j41(0,"a",20),t.nrm(1,"i",21),t.EFF(2),t.k0s(),t.DNE(3,j,3,0,"div",22)),2&o){const n=f.$implicit,l=t.XpG();t.FS9("href",l.sasRedirect(n),t.B4B),t.R7$(2),t.SpI("\xa0",n.fileName,""),t.R7$(),t.vxM(3,n.fileTagIds&&n.fileTagIds.length>0?3:-1)}}function U(o,f){if(1&o&&t.EFF(0),2&o){const n=f.$implicit,l=t.XpG();t.SpI(" ",l.formatSize(n)," ")}}function x(o,f){1&o&&(t.j41(0,"div")(1,"i"),t.EFF(2,"Support Request Form"),t.k0s()())}function S(o,f){if(1&o&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&o){const n=t.XpG().$implicit,l=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,l.userService.formatUser(n.uploadedByUserId))," ")}}function K(o,f){if(1&o&&t.DNE(0,x,3,0,"div",24)(1,S,3,3,"div",24),2&o){const n=f.$implicit;t.Y8G("ngIf",null===n.uploadedByUserId),t.R7$(),t.Y8G("ngIf",null!==n.uploadedByUserId)}}function L(o,f){if(1&o){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const c=t.XpG().$implicit,g=t.XpG();return t.Njj(g.editFile(c))}),t.EFF(1,"edit tags"),t.k0s()}}function N(o,f){if(1&o){const n=t.RV6();t.j41(0,"a",27),t.bIt("click",function(){t.eBV(n);const c=t.XpG().$implicit,g=t.XpG();return t.Njj(g.searchSupport(c))}),t.EFF(1,"search support"),t.k0s()}}function W(o,f){if(1&o){const n=t.RV6();t.j41(0,"a",28),t.bIt("click",function(){t.eBV(n);const c=t.XpG().$implicit,g=t.XpG();return t.Njj(g.deleteFile(c))}),t.EFF(1,"delete"),t.k0s()}}function X(o,f){if(1&o&&(t.DNE(0,L,2,0,"a",25),t.EFF(1," \xa0|\xa0 "),t.DNE(2,N,2,0,"a",25),t.EFF(3," \xa0|\xa0 "),t.DNE(4,W,2,0,"a",26)),2&o){const n=t.XpG();t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked),t.R7$(2),t.Y8G("ngIf",!n.locked)}}let $=(()=>{class o{constructor(n,l,c,g,I,T,V){this.router=n,this.httpClient=l,this.confirmDeleteDialog=c,this.fileEditorDialog=g,this.fileStorageEntryApi=I,this.userService=T,this.staticDataCache=V,this.destroyRef=(0,t.WQX)(t.abz),this.projectId=null,this.locked=!1,this.filterForm=new _.gE({search:new _.MJ("",{nonNullable:!0}),fileTagId:new _.MJ(null)}),this.progress=null,this.form=new _.gE({fileStorageGroupId:new _.MJ("",{nonNullable:!0}),files:new _.MJ([])})}ngOnInit(){this.form.valueChanges.pipe((0,h.B)(200),(0,m.pQ)(this.destroyRef)).subscribe(()=>{this.uploadFiles()})}resetFilterForm(){this.filterForm.patchValue({search:"",fileTagId:null})}filter(n){n.fileStorageGroupId=this.fileStorageGroupId}formatSize(n){return s.A.formatBytes(n.sizeBytes)}sasRedirect(n){return p.c.apiHost+"api/file-storage-entry/sas-redirect/"+n.id}uploadFiles(){if(!this.locked&&this.form.value.files&&0!=this.form.value.files.length){this.form.patchValue({fileStorageGroupId:this.fileStorageGroupId},{emitEvent:!1});var n=this.toFormData(this.form.value);this.httpClient.post(p.c.apiHost+"api/file-storage-entry/upload",n,{reportProgress:!0,observe:"events"}).subscribe({next:l=>{l.type===e.hv.UploadProgress&&l.total&&(this.progress=Math.round(100*l.loaded/l.total))},error:l=>{console.log("Error: ",l)},complete:()=>{this.progress=null,this.fileStorageEntryApi.changed.next(null),this.form.patchValue({files:[]},{emitEvent:!1})}})}}toFormData(n){const l=new FormData;var c={};for(const T of Object.keys(n))if("files"==T){var g=n[T];if(g&&g.length)for(var I=0;I<g.length;I++)l.append("file_"+I,g[I])}else c[T]=n[T];return l.append("data",JSON.stringify(c)),l}deleteFile(n){this.locked||this.confirmDeleteDialog.open({title:n.fileName}).subscribe(l=>{this.fileStorageEntryApi.delete({id:n.id},{successGrowl:"File Deleted"}).subscribe(()=>{})})}editFile(n){this.locked||this.fileEditorDialog.open({file:n}).subscribe(()=>{})}searchSupport(n){s.A.setLocalStorage("SupportFileSearch",n.fileName),null!==this.projectId&&this.router.navigateByUrl(`/project/project-support/${this.projectId}`)}static{this.\u0275fac=function(l){return new(l||o)(t.rXU(u.Ix),t.rXU(e.Qq),t.rXU(a.K),t.rXU(r.U),t.rXU(C.c),t.rXU(d.D),t.rXU(F.t))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["file-browser"]],inputs:{fileStorageGroupId:"fileStorageGroupId",projectId:"projectId",locked:"locked"},decls:27,vars:8,consts:[["itemTemplate",""],[1,"file-list"],[3,"formGroup",4,"ngIf"],[1,"filter-form"],[1,"form",3,"formGroup"],[1,"flex"],[1,"field","is-9"],["type","text","formControlName","search","placeholder","Search",1,"input"],[1,"field","is-3"],["placeholder","Tag","formControlName","fileTagId",3,"dataSource","enableClear","enableSearch"],[1,"is-12","is-right"],[1,"button","is-small",3,"click"],[3,"filter","dataSource","filterForm","take"],["name","filename"],["name","size"],["name","uploadedAt"],["name","uploadedBy"],["justify","right"],[3,"formGroup"],["formControlName","files",3,"showFiles","progress"],["target","blank",1,"link","is-primary",3,"href"],[1,"fas","fa-link"],[1,"tags",2,"margin-top","0.5rem","max-width","500px"],[1,"tag","is-small"],[4,"ngIf"],["class","link is-primary",3,"click",4,"ngIf"],["class","link is-danger",3,"click",4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(l,c){if(1&l){const g=t.RV6();t.j41(0,"div",1),t.DNE(1,A,2,3,"form",2),t.j41(2,"div",3)(3,"form",4)(4,"div",5)(5,"div",6),t.nrm(6,"input",7),t.k0s(),t.j41(7,"div",8),t.nrm(8,"dropdown-select",9),t.k0s()(),t.j41(9,"div",5)(10,"div",10)(11,"button",11),t.bIt("click",function(){return t.eBV(g),t.Njj(c.resetFilterForm())}),t.EFF(12,"show all"),t.k0s()()()()(),t.j41(13,"grid",12),t.bIt("filter",function(T){return t.eBV(g),t.Njj(c.filter(T))}),t.j41(14,"grid-column",13),t.DNE(15,k,4,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(17,"grid-column",14),t.DNE(18,U,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.nrm(20,"grid-datetime-column",15),t.j41(21,"grid-column",16),t.DNE(22,K,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.j41(24,"grid-column",17),t.DNE(25,X,5,3,"ng-template",null,0,t.C5r),t.k0s()()()}2&l&&(t.R7$(),t.Y8G("ngIf",!c.locked),t.R7$(2),t.Y8G("formGroup",c.filterForm),t.R7$(5),t.Y8G("dataSource",c.staticDataCache.fileTag)("enableClear",!0)("enableSearch",!0),t.R7$(5),t.Y8G("dataSource",c.fileStorageEntryApi)("filterForm",c.filterForm)("take",100))},dependencies:[D.bT,_.qT,_.me,_.BC,_.cb,_.j4,_.JD,v.p,M.k,G._,O.C,P.F,D.Jj],encapsulation:2})}}return o})()},3376:(B,E,i)=>{i.d(E,{y:()=>a});var e=i(4438),t=i(1435),m=i(177);function _(r,C){if(1&r){const d=e.RV6();e.j41(0,"a",3),e.bIt("click",function(){e.eBV(d);const D=e.XpG(2);return e.Njj(D.onAdd())}),e.EFF(1,"add"),e.k0s()}}function h(r,C){if(1&r&&e.DNE(0,_,2,0,"a",2),2&r){const d=e.XpG();e.Y8G("ngIf",d.canAdd)}}function s(r,C){if(1&r){const d=e.RV6();e.j41(0,"a",6),e.bIt("click",function(){e.eBV(d);const D=e.XpG().$implicit,v=e.XpG();return e.Njj(v.onEdit(D))}),e.EFF(1,"view/edit"),e.k0s()}}function p(r,C){if(1&r){const d=e.RV6();e.j41(0,"span"),e.EFF(1," \xa0 "),e.j41(2,"a",7),e.bIt("click",function(){e.eBV(d);const D=e.XpG().$implicit,v=e.XpG();return e.Njj(v.onDelete(D))}),e.EFF(3,"delete"),e.k0s()()}}function u(r,C){if(1&r&&e.DNE(0,s,2,0,"a",4)(1,p,4,0,"span",5),2&r){const d=e.XpG();e.Y8G("ngIf",d.canEdit),e.R7$(),e.Y8G("ngIf",d.canDelete)}}let a=(()=>{class r extends t.C{constructor(){super(),this.canAdd=!0,this.add=new e.bkB,this.canEdit=!0,this.edit=new e.bkB,this.canDelete=!0,this.delete=new e.bkB,this.justify="right"}onAdd(){this.add.emit()}onEdit(d){this.edit.emit(d)}onDelete(d){this.delete.emit(d)}static{this.\u0275fac=function(F){return new(F||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["grid-action-column"]],inputs:{canAdd:"canAdd",canEdit:"canEdit",canDelete:"canDelete"},outputs:{add:"add",edit:"edit",delete:"delete"},features:[e.Jv_([{provide:t.C,useExisting:r}]),e.Vt3],decls:4,vars:0,consts:[["headTemplate",""],["itemTemplate",""],["class","link is-success",3,"click",4,"ngIf"],[1,"link","is-success",3,"click"],["class","link is-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"link","is-primary",3,"click"],[1,"link","is-danger",3,"click"]],template:function(F,D){1&F&&e.DNE(0,h,1,1,"ng-template",null,0,e.C5r)(2,u,2,2,"ng-template",null,1,e.C5r)},dependencies:[m.bT],encapsulation:2})}}return r})()},1050:(B,E,i)=>{i.d(E,{u:()=>h});var e=i(1435),t=i(4438),m=i(177);function _(s,p){if(1&s&&(t.EFF(0),t.nI1(1,"date")),2&s){const u=p.$implicit,a=t.XpG();t.SpI(" ",t.i5U(1,1,u[a.name],"dd MMM yyyy"),"\n")}}let h=(()=>{class s extends e.C{static{this.\u0275fac=(()=>{let u;return function(r){return(u||(u=t.xGo(s)))(r||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["grid-date-column"]],features:[t.Jv_([{provide:e.C,useExisting:s}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(a,r){1&a&&t.DNE(0,_,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return s})()},1321:(B,E,i)=>{i.d(E,{F:()=>h});var e=i(1435),t=i(4438),m=i(177);function _(s,p){if(1&s&&(t.EFF(0),t.nI1(1,"date")),2&s){const u=p.$implicit,a=t.XpG();t.SpI(" ",t.i5U(1,1,u[a.name],"dd MMM yyyy HH:mm"),"\n")}}let h=(()=>{class s extends e.C{static{this.\u0275fac=(()=>{let u;return function(r){return(u||(u=t.xGo(s)))(r||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["grid-datetime-column"]],features:[t.Jv_([{provide:e.C,useExisting:s}]),t.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(a,r){1&a&&t.DNE(0,_,2,4,"ng-template",null,0,t.C5r)},dependencies:[m.vh],encapsulation:2})}}return s})()},9779:(B,E,i)=>{i.d(E,{h:()=>s});var e=i(1435),t=i(4412),m=i(4438),_=i(177);function h(p,u){if(1&p&&(m.EFF(0),m.nI1(1,"async")),2&p){const a=u.$implicit,r=m.XpG();m.SpI(" ",r.format(m.bMT(1,1,r.lookup(a[r.name]))),"\n")}}let s=(()=>{class p extends e.C{constructor(){super(...arguments),this._cache={}}lookup(a){if(null==this._cache[a]){if(this._cache[a]=new t.t(null),!this.dataSource)return new t.t(null);this.dataSource.query({skip:0,take:1,filters:[{field:"id",op:"eq",value:a}]}).subscribe(r=>{1==r.items.length&&this._cache[a].next(r.items[0])})}return this._cache[a]}format(a){return a?a.name:""}static{this.\u0275fac=(()=>{let a;return function(C){return(a||(a=m.xGo(p)))(C||p)}})()}static{this.\u0275cmp=m.VBU({type:p,selectors:[["grid-reference-column"]],inputs:{dataSource:"dataSource"},features:[m.Jv_([{provide:e.C,useExisting:p}]),m.Vt3],decls:2,vars:0,consts:[["itemTemplate",""]],template:function(r,C){1&r&&m.DNE(0,h,2,3,"ng-template",null,0,m.C5r)},dependencies:[_.Jj],encapsulation:2})}}return p})()}}]);